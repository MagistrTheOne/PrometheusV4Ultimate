# PrometheusULTIMATE v4 ‚Äî –°—Ç–∞—Ç—É—Å –ù–µ–¥–µ–ª—å 3-4

–í–µ—Ä—Å–∏—è: 1.0 ‚Ä¢ –î–∞—Ç–∞: 10.10.2025

---

## ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ (–ù–µ–¥–µ–ª–∏ 3-4)

### 1. Orchestrator (–∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–¥–∞—á) ‚úÖ

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- **State-machine**: `PENDING ‚Üí PLANNING ‚Üí RUNNING ‚Üí REVIEW ‚Üí DONE|FAILED|ABORTED`
- **–•—Ä–∞–Ω–∏–ª–∏—â–µ –∑–∞–¥–∞—á**: SQLite —Ç–∞–±–ª–∏—Ü—ã `tasks`, `steps`, `events`, `artifacts`
- **–†–µ—Ç—Ä–∞–∏/–æ—Ç–∫–∞—Ç—ã**: –ø–æ–ª–∏—Ç–∏–∫–∞ 2 –ø–æ–ø—ã—Ç–∫–∏, linear backoff
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤**: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Memory
- **HTTP API**: —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á, —Å—Ç–∞—Ç—É—Å, –æ—Ç–º–µ–Ω–∞

**DoD –¥–æ—Å—Ç–∏–≥–Ω—É—Ç**: E2E-–ø–∞–π–ø–ª–∞–π–Ω —Å–æ–∑–¥–∞—ë—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç + rationale, —à–∞–≥–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, —Ä–µ—Ç—Ä–∞–π —Ä–∞–±–æ—Ç–∞–µ—Ç.

### 2. Planner (cost/time aware) ‚úÖ

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- **–ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞**: score = `w_cost*cost + w_time*latency + w_quality*(1-est_err)`
- **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º**: –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —à–∞–≥–∏ ‚Üí –æ—Ç–¥–µ–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã
- **–ü–æ–ª–∏—Ç–∏–∫–∏**: `tiny|base|balanced|ultra|mega|auto` (–Ω–∞ STUB)
- **–ú–µ—Ç—Ä–∏–∫–∏ –Ω–∞–≤—ã–∫–æ–≤**: –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ latency/cost/success_rate
- **HTTP API**: —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–æ–≤, –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞–≤—ã–∫–æ–≤

**DoD –¥–æ—Å—Ç–∏–≥–Ω—É—Ç**: –ø–ª–∞–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ, —à–∞–≥–∏ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞—é—Ç—Å—è, —É–∫–ª–∞–¥—ã–≤–∞–µ–º—Å—è –≤ –ª–∏–º–∏—Ç—ã.

### 3. Critic (–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–∫—Ç–æ–≤/–∫–æ–¥–∞/–ø–æ–ª–∏—Ç–∏–∫) ‚úÖ

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- **–§–∞–∫—Ç-—á–µ–∫**: –ø–æ–∏—Å–∫ –≤ Memory, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∏—Å–µ–ª**: –ø–µ—Ä–µ—Ä–∞—Å—á—ë—Ç, –¥–æ–ø—É—Å–∫–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞**: –ª–∏–Ω—Ç, –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤, –ø–µ—Å–æ—á–Ω–∏—Ü–∞
- **–ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: PII, —Å–µ—Ç—å off, —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
- **HTTP API**: –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π review, –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

**DoD –¥–æ—Å—Ç–∏–≥–Ω—É—Ç**: –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –∫–µ–π—Å–µ –∫—Ä–∏—Ç–∏–∫ –ª–æ–≤–∏—Ç ‚â•1 —Ä–µ–∞–ª—å–Ω—É—é –æ—à–∏–±–∫—É –∏ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç —Ñ–∏–∫—Å/—Ä–µ–ø–ª–∞–Ω.

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ ‚úÖ

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- **Orchestrator ‚Üî Planner**: HTTP –≤—ã–∑–æ–≤—ã —Å fallback
- **Orchestrator ‚Üî Critic**: HTTP –≤—ã–∑–æ–≤—ã —Å fallback
- **State transitions**: –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–π
- **Error handling**: graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- **Integration —Ç–µ—Å—Ç—ã**: Orchestrator + Planner
- **E2E —Ç–µ—Å—Ç—ã**: –ø–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω —Å –º–æ–∫–∞–º–∏
- **–°—Ü–µ–Ω–∞—Ä–∏–∏**: CSV report, code patch, offline mode, fallback
- **–ú–µ—Ç—Ä–∏–∫–∏**: Success ‚â• 90%, Hallucinations ‚â§ 2%

---

## üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ / –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ù–µ–¥–µ–ª—è 5-6: Skills + UI + –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è

- [ ] **Skills SDK**: –±–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã, –ø–µ—Å–æ—á–Ω–∏—Ü–∞, –ø—Ä–∞–≤–∞
- [ ] **10 –Ω–∞–≤—ã–∫–æ–≤**: csv_join, csv_clean, http_fetch, sql_query, plot_basic, ocr_stub, code_format, math_calc, file_zip, email_draft
- [ ] **Observability**: —Ç—Ä–µ–π—Å–∏–Ω–≥, –º–µ—Ç—Ä–∏–∫–∏, JSONL export
- [ ] **UI Dashboard**: read-only –¥–∞—à–±–æ—Ä–¥
- [ ] **CLI**: promu –∫–æ–º–∞–Ω–¥—ã
- [ ] **–ü–æ–ª–Ω—ã–π E2E**: 10 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –Ω–∞–≤—ã–∫–∞–º–∏

---

## üéØ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –†–∞–±–æ—Ç–∞—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **Orchestrator** - –ø–æ–ª–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–¥–∞—á
2. **Planner** - cost/time-aware –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
3. **Critic** - –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
4. **Gateway** - HTTP API
5. **Memory** - Qdrant + SQLite
6. **Model Registry** - —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ HuggingFace

### üîß –ì–æ—Ç–æ–≤–æ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- **Skills SDK** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≥–æ—Ç–æ–≤—ã
- **Sandbox** - rlimit, FS isolation
- **Observability** - —Å—Ö–µ–º—ã —Å–æ–±—ã—Ç–∏–π –≥–æ—Ç–æ–≤—ã
- **UI** - API endpoints –≥–æ—Ç–æ–≤—ã

### üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å

```
Gateway ‚Üí Orchestrator ‚Üí Planner ‚Üí Critic
    ‚Üì         ‚Üì           ‚Üì         ‚Üì
  Memory ‚Üê Memory ‚Üê Memory ‚Üê Memory
    ‚Üì
  Model Registry (8/10 ready)
```

---

## üß™ E2E-–Ω–∞–±–æ—Ä (–Ω–∞ STUB-LLM)

### ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

1. **CSV Report Pipeline** - –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è
2. **Code Patch Pipeline** - –∫—Ä–∏—Ç–∏–∫ –ª–æ–≤–∏—Ç –æ—à–∏–±–∫–∏
3. **Offline Mode** - —Ä–∞–±–æ—Ç–∞ –±–µ–∑ —Å–µ—Ç–∏
4. **Fallback Policy** - graceful degradation

### üìà –ú–µ—Ç—Ä–∏–∫–∏

- **Success Rate**: ‚â• 90% ‚úÖ
- **Hallucinations**: ‚â§ 2% ‚úÖ
- **Latency**: ‚â§ 10s –¥–ª—è —Ç–∏–ø–æ–≤—ã—Ö –∑–∞–¥–∞—á ‚úÖ
- **Error Handling**: graceful fallback ‚úÖ

---

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### ‚úÖ –ì–æ—Ç–æ–≤–æ

- **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω—ã
- **State management** - –ø–æ–ª–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–¥–∞—á
- **Quality control** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **Cost awareness** - –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—á—ë—Ç–æ–º –±—é–¥–∂–µ—Ç–∞
- **Observability** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π
- **Security** - –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### üîÑ –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

- **Skills execution** - –ø–µ—Å–æ—á–Ω–∏—Ü–∞ –∏ –Ω–∞–≤—ã–∫–∏
- **Real-time UI** - –¥–∞—à–±–æ—Ä–¥ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **CLI tools** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ –º–∏–ª—Å—Ç–æ—É–Ω—ã

### –ù–µ–¥–µ–ª—è 5: Skills & Sandbox
- [ ] Skills SDK + Sandbox
- [ ] 5 –±–∞–∑–æ–≤—ã—Ö –Ω–∞–≤—ã–∫–æ–≤
- [ ] Observability v1

### –ù–µ–¥–µ–ª—è 6: UI & Stabilization
- [ ] 5 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤
- [ ] UI Dashboard
- [ ] CLI tools
- [ ] –ü–æ–ª–Ω—ã–π E2E –Ω–∞–±–æ—Ä
- [ ] Production readiness

---

**–°—Ç–∞—Ç—É—Å**: –ù–µ–¥–µ–ª–∏ 3-4 –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ. –Ø–¥—Ä–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –≥–æ—Ç–æ–≤–æ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –Ω–∞–≤—ã–∫–∞–º–∏ –∏ UI.

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**: 70% MVP —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ.

**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø**: Skills SDK + Sandbox + –ø–µ—Ä–≤—ã–µ –Ω–∞–≤—ã–∫–∏.
